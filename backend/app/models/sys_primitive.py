#!/usr/bin/env python3
# -*- coding: utf-8 -*-
from typing import Union

from sqlalchemy import ForeignKey, String
from sqlalchemy.orm import Mapped, mapped_column, relationship

from backend.app.models.base import Base, id_key


class Primitive(Base):
    """
    原语表，根据 type 字段区分不同的原语。关于各原语及其下辖字段，
    参见 https://boofuzz.readthedocs.io/en/stable/user/protocol-definition.html#primitives。
    """
    __tablename__ = 'sys_primitive'

    id: Mapped[id_key] = mapped_column(init=False)
    name: Mapped[str] = mapped_column(String(50), index=True, comment='原语名称')
    default_value: Mapped[int] = mapped_column(default=0, comment="原语默认值")
    
    # 部门用户一对多
    case_id: Mapped[int | None] = mapped_column(
        ForeignKey('sys_case.id', ondelete='SET NULL'), default=None, comment='原语所属用例ID'
    )
    case: Mapped[Union['Case', None]] = relationship(init=False, back_populates='primitives')