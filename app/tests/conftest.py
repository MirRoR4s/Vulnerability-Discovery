import pytest
from fastapi.testclient import TestClient
from main import app
from app.core.conf import settings

CLIENT = TestClient(app)

# Test user
PYTEST_USERNAME = 'admin'
PYTEST_PASSWORD = '123456'



@pytest.fixture(scope='module')
def token() -> dict[str, str]:
    data = {
        'username': PYTEST_USERNAME,
        'password': PYTEST_PASSWORD,
    }
    response =  CLIENT.post(f'{settings.API_V1_STR}/auth/swagger_login', data=data)
    print(response)
    token_type = response.json()['token_type']
    access_token = response.json()['access_token']
    headers = {'Authorization': f'{token_type} {access_token}'}
    return headers
